<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Feedback Midterms Reviewer</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <style>
        /* Use the Inter font for the document */
        :root { --font-sans: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
        html, body { font-family: var(--font-sans); }

        /* Option button visual states */
        .quiz-option { min-height: 3rem; display: flex; align-items: center; justify-content: flex-start; padding-left: 1rem; padding-right: 1rem; }
        .quiz-option.selected-answer { background-color: #3b82f6; color: #fff; border-color: #3b82f6; }
        .quiz-option.correct-answer { background-color: #16a34a; color: #fff; border-color: #16a34a; }
        .quiz-option.incorrect-answer { background-color: #ef4444; color: #fff; border-color: #ef4444; }

        /* Remove focus outline for mouse but keep visible focus for keyboard */
        .quiz-option:focus { outline: 3px solid rgba(59,130,246,0.25); outline-offset: 2px; }

        /* Small helpers */
        .visually-hidden { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; border: 0; padding: 0; margin: -1px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <header class="bg-white shadow-md">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <h1 class="text-3xl font-bold text-indigo-600">MySite</h1>
            </div>

            <!-- Tab navigation using Tailwind utilities directly -->
            <nav class="flex space-x-4 border-t border-gray-100" aria-label="Primary">
                <a href="index.html" class="px-3 py-2 font-medium text-sm rounded-t-lg bg-white text-indigo-600 border-b-2 border-indigo-600">Quiz 3</a>
                <a href="quiz.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Quiz 1&2</a>
                <a href="lesson5.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Lesson 5</a>
                <a href="lesson6.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Lesson 6</a>
                <a href="lesson7.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Lesson 7</a>
                <a href="lesson8.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Lesson 8</a>
                <a href="lesson9.html" class="px-3 py-2 font-medium text-sm rounded-t-lg text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Lesson 9</a>
            </nav>
        </div>
    </header>

    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div id="app" class="w-full max-w-2xl bg-white rounded-lg shadow-xl p-6 md:p-8 mx-auto">

            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">Control Systems Quiz</h1>

            <!-- Quiz Container -->
            <section id="quiz-container" aria-labelledby="quiz-heading">
                <div class="flex justify-between items-center mb-4">
                    <div id="progress" class="text-sm font-medium text-gray-600">Question 1 / 18</div>
                    <div id="score" class="text-sm font-medium text-gray-600">Score: 0</div>
                </div>

                <h2 id="question-text" class="text-xl font-semibold text-gray-900 mb-6 min-h-[5rem]">Loading question...</h2>

                <!-- Options container: we use buttons with data attributes and event delegation for efficiency -->
                <div id="options-container" class="space-y-3" role="listbox" aria-labelledby="question-text" tabindex="0"></div>

                <!-- Feedback with aria-live for screen readers -->
                <div id="feedback-message" aria-live="polite" class="mt-6 text-lg font-medium text-center hidden"></div>

                <div class="mt-8 flex justify-end gap-3">
                    <button id="submit-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-blue-700 transition-colors duration-200" disabled>Submit</button>
                    <button id="next-btn" class="bg-gray-700 text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-gray-800 transition-colors duration-200 hidden">Next</button>
                </div>
            </section>

            <!-- Results -->
            <section id="results-container" class="hidden text-center" aria-hidden="true">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Quiz Complete!</h2>
                <p id="final-score" class="text-2xl text-gray-700 mb-8">Your final score is 0 / 18</p>
                <button id="restart-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-blue-700 transition-all duration-200 transform hover:scale-105">Restart Quiz</button>
            </section>

        </div>
    </main>

    <script>
        // -------------------------
        // Data & State
        // -------------------------
        const questions = [
            { question: "The limitation of linearization in system design is that it:", options: ["Ignores high-frequency dynamics entirely.", "Removes feedback path dependency.", "Works for both large and small inputs.", "Is valid only near the chosen operating point."], correctAnswer: "Is valid only near the chosen operating point." },
            { question: "Nonlinear effects become dominant when:", options: ["System gain is unity.", "Time constant is small.", "Deviations are large.", "Damping ratio is zero."], correctAnswer: "Deviations are large." },
            { question: "In control systems, an equilibrium point is where:", options: ["The gain is maximum.", "The input changes continuously.", "All derivatives of state variables are zero.", "The output oscillates around zero."], correctAnswer: "All derivatives of state variables are zero." },
            { question: "The impulse response of an LTI system completely characterizes its:", options: ["Dynamic and steady-state behavior", "Time-varying behavior", "Initial conditions", "Nonlinear properties"], correctAnswer: "Dynamic and steady-state behavior" },
            { question: "The process of small-signal analysis assumes that:", options: ["Inputs vary largely from the equilibrium.", "Deviations around equilibrium are small.", "System poles move away from the origin.", "Gains increase with time."], correctAnswer: "Deviations around equilibrium are small." },
            { question: "Moving a pole closer to the imaginary axis causes:", options: ["Faster response and more damping.", "Slower response and less oscillation.", "Slower response and more oscillation.", "Faster response and less damping."], correctAnswer: "Slower response and more oscillation." },
            { question: "In physical systems, linearization is often done about:", options: ["Steady-state operating points.", "Points of maximum oscillation.", "Randomly chosen input levels.", "Zero-input conditions only."], correctAnswer: "Steady-state operating points." },
            { question: "The location of poles in the s-plane determines the system's:", options: ["Hardware implementation.", "Sampling frequency.", "Time-domain response characteristics.", "Type of input signal."], correctAnswer: "Time-domain response characteristics." },
            { question: "A pole at (s = -10) compared to (s = -2) represents:", options: ["A faster response.", "Equal transient speed.", "A slower response.", "Pure oscillation."], correctAnswer: "A faster response." },
            { question: "A pole located exactly at the origin indicates:", options: ["The system response oscillates infinitely.", "The system is unstable.", "The system has a steady-state error to step input.", "The system behaves as an integrator."], correctAnswer: "The system behaves as an integrator." },
            { question: "The order of an LTI system equals:", options: ["The number of zeros", "The highest power of (s) in the numerator", "The sum of poles and zeros", "The highest power of (s) in the denominator"], correctAnswer: "The highest power of (s) in the denominator" },
            { question: "The slope of the tangent at the operating point in a nonlinear function represents:", options: ["The nonlinear gain", "The system pole", "The small-signal gain", "The steady-state error"], correctAnswer: "The small-signal gain" },
            { question: "The transfer function (G(s)) of an LTI system represents:", options: ["The integral of the impulse response", "The ratio of energy input to power output", "The system's time-domain response directly", "The ratio of Laplace-transformed output to input under zero initial conditions"], correctAnswer: "The ratio of Laplace-transformed output to input under zero initial conditions" },
            { question: "Linearization in control systems is used primarily to:", options: ["Approximate a nonlinear system near an equilibrium point.", "Design systems without using transfer functions.", "Eliminate nonlinearities from a system completely.", "Convert discrete systems into continuous-time models."], correctAnswer: "Approximate a nonlinear system near an equilibrium point." },
            { question: "A causal LTI system must have an impulse response that is:", options: ["Constant for all time", "Nonzero only for (t < 0)", "Zero for (t < 0)", "Symmetric about (t = 0)"], correctAnswer: "Zero for (t < 0)" },
            { question: "The pole-zero map graphically represents:", options: ["Only imaginary parts of zeros.", "Only the real parts of poles.", "Roots of numerator and denominator in the frequency domain.", "Gain versus frequency plot."], correctAnswer: "Roots of numerator and denominator in the frequency domain." },
            { question: "A real pole in the left-half plane represents a:", options: ["Pure oscillation with zero damping.", "Constant output with no dynamics.", "Stable exponential decay.", "Unstable exponential growth."], correctAnswer: "Stable exponential decay." },
            { question: "The Laplace transform is used in LTI systems to:", options: ["Remove the need for modeling", "Analyze only steady-state response", "Eliminate nonlinear effects", "Transform differential equations into algebraic equations"], correctAnswer: "Transform differential equations into algebraic equations" }
        ];

        // Derive correct index for each question once (avoid string comparison later)
        questions.forEach(q => { q.correctIndex = q.options.indexOf(q.correctAnswer); });

        let currentQuestionIndex = 0;
        let score = 0;
        let selectedIndex = null;
        let feedbackGiven = false;

        // -------------------------
        // Cached DOM nodes
        // -------------------------
        const progressEl = document.getElementById('progress');
        const scoreEl = document.getElementById('score');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const finalScoreEl = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');

        // -------------------------
        // Utility & rendering
        // -------------------------
        function resetFeedbackUI() {
            feedbackMessageEl.classList.add('hidden');
            feedbackMessageEl.textContent = '';
            feedbackMessageEl.classList.remove('text-green-600', 'text-red-600');
        }

        function renderQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            feedbackGiven = false;
            selectedIndex = null;
            resetFeedbackUI();
            submitBtn.disabled = true;
            submitBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');

            const q = questions[currentQuestionIndex];

            questionTextEl.textContent = q.question;
            progressEl.textContent = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
            scoreEl.textContent = `Score: ${score}`;

            // Build options with a document fragment for performance
            optionsContainerEl.innerHTML = '';
            const frag = document.createDocumentFragment();

            q.options.forEach((optText, idx) => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.setAttribute('data-option-index', idx);
                btn.setAttribute('data-option-text', optText);
                btn.setAttribute('role', 'option');
                btn.className = 'quiz-option w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-colors duration-200 text-left';
                btn.tabIndex = 0;
                btn.textContent = optText;
                frag.appendChild(btn);
            });

            optionsContainerEl.appendChild(frag);

            // Set focus to options container for keyboard users
            optionsContainerEl.focus();
        }

        // Event delegation: select option on click
        optionsContainerEl.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-option-index]');
            if (!btn || feedbackGiven) return;
            selectOption(parseInt(btn.getAttribute('data-option-index'), 10), btn);
        });

        // Keyboard support: Enter/Space to select, Arrow keys to navigate
        optionsContainerEl.addEventListener('keydown', (e) => {
            const key = e.key;
            const focused = document.activeElement;
            // If the focused element is an option button, handle Enter/Space to select it
            if (focused && focused.matches('button[data-option-index]') && !feedbackGiven) {
                if (key === 'Enter' || key === ' ') {
                    e.preventDefault();
                    const idx = parseInt(focused.getAttribute('data-option-index'), 10);
                    selectOption(idx, focused);
                    return;
                }
            }

            // Allow ArrowUp/ArrowDown to move focus between options
            if (key === 'ArrowDown' || key === 'ArrowUp') {
                e.preventDefault();
                const all = Array.from(optionsContainerEl.querySelectorAll('button[data-option-index]'));
                if (!all.length) return;
                let i = all.indexOf(document.activeElement);
                if (i === -1) {
                    // focus first or last depending on arrow
                    const target = (key === 'ArrowDown') ? all[0] : all[all.length - 1];
                    target.focus();
                } else {
                    i = (key === 'ArrowDown') ? Math.min(all.length - 1, i + 1) : Math.max(0, i - 1);
                    all[i].focus();
                }
            }
        });

        function selectOption(idx, btnEl) {
            // Clear previous selection
            optionsContainerEl.querySelectorAll('button').forEach(b => {
                b.classList.remove('selected-answer');
                b.setAttribute('aria-selected', 'false');
            });

            btnEl.classList.add('selected-answer');
            btnEl.setAttribute('aria-selected', 'true');

            selectedIndex = idx;
            submitBtn.disabled = false;
            submitBtn.focus();
        }

        // Submit handler
        submitBtn.addEventListener('click', () => {
            if (selectedIndex === null || feedbackGiven) return;
            feedbackGiven = true;

            const q = questions[currentQuestionIndex];
            const isCorrect = (selectedIndex === q.correctIndex);

            // Update score and feedback
            if (isCorrect) {
                score++;
                feedbackMessageEl.textContent = 'Correct!';
                feedbackMessageEl.classList.add('text-green-600');
            } else {
                feedbackMessageEl.textContent = `Incorrect. The correct answer is: ${q.options[q.correctIndex]}`;
                feedbackMessageEl.classList.add('text-red-600');
            }
            feedbackMessageEl.classList.remove('hidden');

            // Visual marking and disable options
            optionsContainerEl.querySelectorAll('button').forEach((b) => {
                const idx = parseInt(b.getAttribute('data-option-index'), 10);
                b.disabled = true;
                b.classList.remove('selected-answer', 'hover:bg-gray-50');
                if (idx === q.correctIndex) b.classList.add('correct-answer');
                else if (idx === selectedIndex && !isCorrect) b.classList.add('incorrect-answer');
            });

            scoreEl.textContent = `Score: ${score}`;

            // Swap buttons
            submitBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            nextBtn.focus();
        });

        // Next question
        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            renderQuestion();
        });

        // Restart
        restartBtn.addEventListener('click', () => {
            currentQuestionIndex = 0;
            score = 0;
            resultsContainer.classList.add('hidden');
            resultsContainer.setAttribute('aria-hidden', 'true');
            quizContainer.classList.remove('hidden');
            quizContainer.setAttribute('aria-hidden', 'false');
            renderQuestion();
        });

        function showResults() {
            quizContainer.classList.add('hidden');
            quizContainer.setAttribute('aria-hidden', 'true');
            resultsContainer.classList.remove('hidden');
            resultsContainer.setAttribute('aria-hidden', 'false');
            finalScoreEl.textContent = `Your final score is ${score} / ${questions.length}`;
            finalScoreEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Initial render
        renderQuestion();
    </script>
</body>
</html>
